from math import prod
from Crypto.Util.number import long_to_bytes

def extract_primes(hint):
    primes = []
    while hint:
        hint >>= 1
        if hint % 2 == 1:
            primes.append(hint & (2**128 - 1))
            hint >>= 128
    return primes

def decrypt(n, e, c, primes):
    assert n == prod(primes), "The product of primes does not match n!"
    phi = prod([p - 1 for p in primes])  # Calculate the totient Ï†(n)
    print(f"phi:{phi}")
    d = pow(e, -1, phi)  # Find the modular inverse of e
    m = pow(c, d, n)  # Decrypt ciphertext c
    return long_to_bytes(m)  # Convert decrypted integer to bytes

# Prompt the user for the hint, n, e, and c values
hint = 0b11000001001110001000000101110010111100001000001000110000000101110011101010001101000010101100100000001001011110010010110011001101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001110100010110111011010001100111001100111111001101000011000000111110101011110000010111101010101000001010010001101011101111001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111100111010100101110000110011110010110100000000011010110001110101011101101101110000011000010010101000010100000001100111110110010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010111010101111100101101111110000100101001100100100100001111110001001100000101100101010100100100110111111010110000110101100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111010001100101010010000000100001010010000010110110000000101000110111011011111110111010110100110000001100110001101100010000101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010001111100011010000110000111111100010101011101111110110001001100010010110110001011110001111000000010111011110111101010111010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011011001001000110010110000110000010101011100111100011001010100101111111110100111000000000011101100111000000010001010110110111011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001101101110001111111001011110101101100111111111000010101001101001011101110011101011001000100001010110011111111101101001011101100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100110110101101001001011111100111101101000010011000011001001111101111101100111011011100110010110100101110110000001010010100100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010010010001111010011011011101001100100001111110001110100100110001100110111001010010010111100010011001100110101000010110010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000011001011110001111110111100001101100010111000011110010010100110001100011011100010111010011101100101001000111110010111011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000011000010101011001100111111000111011110000010011101111110111110011010000001111011100010011001010101000000110101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010011010101001100100011000011011000000011010001110000001011100101101100111110010110111011111111010111100101110101111100111001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000010101111001001010011111011000100110101101111100101000100100001110011000100000001011110100000111110100110111101100101000101100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111110111100110100101000110101001101111100111101011101110011110100111000010010111100111010001001111111011111010101010000100110010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010011100010010011001010110110001001100001110111111010001010100111101000010000111100111001100110001111000011101001000010101010101000000000000000000000
n = 119493145368134756606524581488517378672235496744508597127639648421685629462649680337305664581985725401892086474314689141024498358715132868441978738105268336335778301627806695859205063825847290995872425532374614756539044160447358903375166525543471922868488499105664355206800751381027260462074705122647672994384365333260862845803962495145681040264675164695690862737006515315087470040757606517140071798300326022127659497206583492859643180260756285101547522674696613261207152550090000611298331939402585491230470733454735317291288404096144773097239721697692471487615973994925335486666529576878075473132154318910180009691
e = 65537
c = 78434014553061170529838401917720357645901208101352296269884472900978844319305951884764695717375322363272928093737865793113104432023794235229497701142692681415679549147532592802702053823324082733182072770779006523720442490771120987890027997070704393610765382574187921750560918055356164458340750383236011537901475045013520557031618820264221766743094536121925226791850895255993453048670745607742469934947653147879259892501050933253400391984499229656112961295969492487005786860006961292676090836472527246673699345029628224872195546099448661501561676622720260514226385260271583307493991971640825413235694692735476316469

# Extract primes from hint
primes = extract_primes(hint)
byts =  decrypt(n, e, c, primes)
# Decrypt the message
decrypted_message = decrypt(n, e, c, primes)

# Print the final decrypted message
print("Decrypted message:", decrypted_message.decode())

for prime in primes:
    print(f"Extracted prime: {prime}")

for test in byts:
    print(f"Extracted longbytes: {test}")
